# Walkthrough: security.md と運用Runbookへのリスク反映

## 実施サマリ
- 2026-02-15 に実施したセキュリティ/コスト関連のドキュメント更新を1ファイルに統合した。
- 対象は `docs/security.md` と `docs/Phase2/production-operations.md`。

## 1) セキュリティリスクチェックリスト作成（17:59）

### 背景
- L7（HTTPレイヤー）攻撃観点で確認したリスクを、運用時に継続確認できる形で文書化する必要があった。

### 対応内容
- `docs/security.md` を新規作成した。
- 今回判明したリスクをチェックリスト形式で記録した。
  - 共通セキュリティヘッダ未整備
  - レート制限・スロットリング未導入
  - HTTPリクエストボディサイズ上限未設定
  - HTTP(80)公開時のHTTPS強制の明示不足

## 2) security.md へ対応方針を追加（18:00）

### 背景
- セキュリティリスクの列挙だけでなく、実行可能な対応方針（優先度・完了条件）を明文化する必要があった。

### 対応内容
- `docs/security.md` に「対応方針（2026-02-15時点）」を追加した。
- 各リスクに対して以下を定義した。
  - 優先度
  - 対応方針
  - 完了条件（受け入れ基準）
- さらに、実施順序（推奨）を明記した。

## 3) Fly.ioコスト増大リスクを security.md へ追加（19:28）

### 背景
- Fly.io運用におけるコスト増大リスクと対応方針を、既存のセキュリティ記録と同じ文書で管理したい要望があった。

### 対応内容
- `docs/security.md` に以下を追加した。
  - `Fly.io コスト増大リスク（運用）` セクション
  - `対応方針（Fly.io コスト）` テーブル
  - `実施順序（Fly.io コスト・推奨）`
- リスクは固定費、デプロイ頻度、migration/smoke 実行、Authentik運用、監視未整備の観点で整理した。

## 4) Phase2 Runbook へコスト運用を同期（19:30）

### 背景
- `docs/security.md` に追加した Fly.io コスト増大リスクと対応方針を、運用Runbook（`docs/Phase2/production-operations.md`）へ同期する必要があった。

### 対応内容
- `docs/Phase2/production-operations.md` を更新した。
  - 定期運用チェックリストにコスト監視項目を追加
  - `9. Fly.io コスト管理` セクションを追加
    - 主要リスク
    - 対応方針
    - 週次モニタリング手順（閾値・エスカレーション）

## 変更ファイル（統合後）
- `docs/security.md`
- `docs/Phase2/production-operations.md`
- `.walkthrough/202602151759_walkthrough_add_security_risk_checklist.md`

## 補足
- 既存の防御（CSRF、セッションCookie属性、Open Redirect対策）はリスク項目とは分けてメモとして記載した。
- 対応方針は現時点の案であり、運用結果や誤検知率を見て閾値・優先度を見直す前提とした。
- コスト運用は security ドキュメントの方針に合わせ、運用担当が実施しやすい手順（週次確認・閾値・対応）へ具体化した。
